# Upal Design Document

> **Date**: 2026-02-19
> **Status**: Approved
> **Summary**: Hybrid AI workflow platform inspired by Google Opal + Google ADK, with local/multi-model support

## 1. Overview

**Upal**ì€ Google Opalì˜ ë¹„ì£¼ì–¼ ì›Œí¬í”Œë¡œìš° ë¹Œë”ì™€ Google ADKì˜ ì½”ë“œ í¼ìŠ¤íŠ¸ ì—ì´ì „íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ AI í”Œë«í¼ì´ë‹¤.

### Opalê³¼ì˜ í•µì‹¬ ì°¨ë³„ì 

| í•­ëª© | Google Opal | Upal |
|------|-------------|------|
| ëª¨ë¸ | Gemini/Imagen/Veo3 ì „ìš© | ë¡œì»¬(Ollama/llama.cpp/vLLM) + í´ë¼ìš°ë“œ(OpenAI/Anthropic/Google ë“±) |
| ì¸í„°í˜ì´ìŠ¤ | ë¹„ì£¼ì–¼ ì—ë””í„°ë§Œ | ë¹„ì£¼ì–¼ ì—ë””í„° + ì½”ë“œ(YAML/JSON) + CLI |
| ë„êµ¬ í™•ì¥ | ë‚´ì¥ ë„êµ¬ë§Œ | MCP í”„ë¡œí† ì½œ í˜¸í™˜ + HTTP API + ì»¤ìŠ¤í…€ í•¨ìˆ˜ |
| ë°°í¬ | Google í´ë¼ìš°ë“œ | Self-hosted (Docker Compose) |
| ëŒ€ìƒ | ë¹„ê°œë°œì | ê°œë°œì + ë¹„ê°œë°œì ë™ë“± |

### ì•„í‚¤í…ì²˜ ì ‘ê·¼ë²•: Workflow-First

ì›Œí¬í”Œë¡œìš° DAG ì—”ì§„ì„ ì½”ì–´ë¡œ ì‚¼ê³ , ADKì˜ ì—ì´ì „íŠ¸ íŒ¨í„´ì„ ì›Œí¬í”Œë¡œìš° ë…¸ë“œ íƒ€ì…ìœ¼ë¡œ êµ¬í˜„í•œë‹¤. JSON ì›Œí¬í”Œë¡œìš° ì •ì˜ê°€ ë¹„ì£¼ì–¼ ì—ë””í„°ì™€ ì½”ë“œì˜ ê³µí†µ ë°ì´í„° ëª¨ë¸ì´ ëœë‹¤.

## 2. Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Upal Platform                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     React Frontend          â”‚  â”‚     Go SDK / CLI         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  (Code-first interface)  â”‚  â”‚
â”‚  â”‚  â”‚ Visual Workflow Editorâ”‚  â”‚  â”‚  upal.NewWorkflow(...)   â”‚  â”‚
â”‚  â”‚  â”‚ (React Flow ê¸°ë°˜)     â”‚  â”‚  â”‚  upal run workflow.yaml  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚                  â”‚
â”‚  â”‚  â”‚ Execution Monitor     â”‚  â”‚             â”‚                  â”‚
â”‚  â”‚  â”‚ (ì‹¤ì‹œê°„ ì‹¤í–‰ ì¶”ì )    â”‚  â”‚             â”‚                  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                  â”‚
â”‚                 â”‚                             â”‚                  â”‚
â”‚                 â–¼                             â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   REST / WebSocket API                    â”‚   â”‚
â”‚  â”‚              (ì›Œí¬í”Œë¡œìš° CRUD + ì‹¤í–‰ + ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Workflow Engine (Core)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ DAG     â”‚ â”‚ Node     â”‚ â”‚ Event   â”‚ â”‚ Session &    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Runner  â”‚ â”‚ Registry â”‚ â”‚ Bus     â”‚ â”‚ State Mgr    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Node Types                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Input  â”‚ â”‚ Agent    â”‚ â”‚ Tool â”‚ â”‚ Output           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Node   â”‚ â”‚ Node     â”‚ â”‚ Node â”‚ â”‚ Node             â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               Model Provider Layer                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ OpenAI Compatâ”‚ â”‚ Anthropic    â”‚ â”‚ Google Gemini    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (ê¸°ë³¸)       â”‚ â”‚ Adapter      â”‚ â”‚ Adapter          â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”‚ Ollama       â”‚                                        â”‚  â”‚
â”‚  â”‚  â”‚ llama.cpp    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ vLLM         â”‚  â”‚ MCP Client (Tool Discovery)     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Storage Layer                           â”‚   â”‚
â”‚  â”‚                    PostgreSQL                              â”‚   â”‚
â”‚  â”‚    (ì›Œí¬í”Œë¡œìš°/ì„¸ì…˜/ìƒíƒœ/ì´ë²¤íŠ¸ ë¡œê·¸/ë²„ì „ íˆìŠ¤í† ë¦¬)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì´ì–´ ì„¤ëª…

1. **Frontend Layer**: React ë¹„ì£¼ì–¼ ì—ë””í„° (React Flow) + ì‹¤í–‰ ëª¨ë‹ˆí„°
2. **API Layer**: REST (CRUD) + WebSocket (ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼)
3. **Workflow Engine**: DAG Runner, Node Registry, Event Bus, Session/State
4. **Node Types**: Input, Agent, Tool, Output (4ê°œ ë…¸ë“œ íƒ€ì…)
5. **Model Provider**: OpenAI í˜¸í™˜ ê¸°ë³¸ + Anthropic/Gemini ì–´ëŒ‘í„°
6. **MCP Client**: ì™¸ë¶€ MCP ì„œë²„ ì—°ê²°ë¡œ Tool í™•ì¥
7. **Storage**: PostgreSQL

## 3. Workflow Engine

### 3.1 Workflow Definition (JSON/YAML)

ì›Œí¬í”Œë¡œìš°ëŠ” **ë…¸ë“œ(Node)**ì™€ **ì—£ì§€(Edge)**ë¡œ êµ¬ì„±ëœë‹¤. ì½”ë“œì™€ ë¹„ì£¼ì–¼ ì—ë””í„° ëª¨ë‘ ì´ JSONì„ ê³µìœ í•œë‹¤:

```yaml
name: "blog-writer"
version: 1
nodes:
  - id: "input_topic"
    type: "input"
    config:
      input_type: "text"
      label: "ë¸”ë¡œê·¸ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"

  - id: "research"
    type: "agent"
    config:
      model: "ollama/llama3.2"
      system_prompt: "ë‹¹ì‹ ì€ ë¦¬ì„œì¹˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤."
      tools: ["web_search", "mcp://brave-search"]
      max_turns: 5

  - id: "outline"
    type: "agent"
    config:
      model: "openai/gpt-4o"
      prompt: "{{research.output}}ì„ ë°”íƒ•ìœ¼ë¡œ ë¸”ë¡œê·¸ ì•„ì›ƒë¼ì¸ì„ ì‘ì„±í•˜ì„¸ìš”."

  - id: "write_intro"
    type: "agent"
    config:
      model: "anthropic/claude-sonnet-4-20250514"
      prompt: "{{outline.output}}ì˜ ì„œë¡ ì„ ì‘ì„±í•˜ì„¸ìš”."

  - id: "write_body"
    type: "agent"
    config:
      model: "anthropic/claude-sonnet-4-20250514"
      prompt: "{{outline.output}}ì˜ ë³¸ë¡ ì„ ì‘ì„±í•˜ì„¸ìš”."

  - id: "output_blog"
    type: "output"
    config:
      output_type: "markdown"

edges:
  - from: "input_topic"
    to: "research"
  - from: "research"
    to: "outline"
  - from: "outline"
    to: "write_intro"
  - from: "outline"
    to: "write_body"
  - from: "write_intro"
    to: "output_blog"
  - from: "write_body"
    to: "output_blog"
```

### 3.2 Flow Control via Edge Topology

íë¦„ ì œì–´ëŠ” ë³„ë„ ë…¸ë“œ íƒ€ì…ì´ ì•„ë‹Œ **ì—£ì§€ ì—°ê²° íŒ¨í„´**ìœ¼ë¡œ ìë™ ê²°ì •ëœë‹¤:

```
# ìˆœì°¨ ì‹¤í–‰: A â†’ B â†’ C (ì„ í˜• ì²´ì¸)
A â”€â”€â†’ B â”€â”€â†’ C

# ë³‘ë ¬ ì‹¤í–‰: Aì˜ ì¶œë ¥ì´ B, Cë¡œ ë™ì‹œ ë¶„ê¸° (fan-out)
      â”Œâ”€â”€â†’ B â”€â”€â”
A â”€â”€â”€â”€â”¤         â”œâ”€â”€â†’ D    (DëŠ” B,C ëª¨ë‘ ì™„ë£Œ í›„ ì‹¤í–‰ = fan-in)
      â””â”€â”€â†’ C â”€â”€â”˜

# ë£¨í”„: Reviewer â†’ Reviser â†’ ë‹¤ì‹œ Reviewer (back-edge)
Draft â”€â”€â†’ Reviewer â”€â”€â†’ Reviser â”€â”€â”
              â–²                   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          (exit_conditionìœ¼ë¡œ ë£¨í”„ íƒˆì¶œ)
```

Runnerê°€ í† í´ë¡œì§€ë¥¼ ë¶„ì„í•´ì„œ ìë™ íŒë‹¨:
- ë…¸ë“œì˜ out-edgesê°€ ì—¬ëŸ¬ ê°œ â†’ ë³‘ë ¬ fan-out (goroutine)
- ë…¸ë“œì˜ in-edgesê°€ ì—¬ëŸ¬ ê°œ â†’ fan-in (ëª¨ë“  ë¶€ëª¨ ì™„ë£Œ ëŒ€ê¸°)
- back-edge ê°ì§€ â†’ ë£¨í”„ ì‹¤í–‰ (exit_condition í‰ê°€)
- ì„ í˜• ì²´ì¸ â†’ ìˆœì°¨ ì‹¤í–‰

ë£¨í”„ ì—£ì§€ ì •ì˜:
```yaml
edges:
  - from: "reviewer"
    to: "reviser"
    loop:
      max_iterations: 3
      exit_when: "{{reviewer.output.score}} >= 8"
```

### 3.3 Node Types

| íƒ€ì… | ì—­í•  | ìƒ‰ìƒ |
|------|------|------|
| `input` | ì‚¬ìš©ì ì…ë ¥ ìˆ˜ì§‘ (í…ìŠ¤íŠ¸, ì´ë¯¸ì§€ ë“±) | ğŸŸ¡ ë…¸ë€ìƒ‰ |
| `agent` | LLM í˜¸ì¶œ. tools ì—†ìœ¼ë©´ ë‹¨ë°œ, ìˆìœ¼ë©´ ë©€í‹°í„´ ì—ì´ì „íŠ¸ ë£¨í”„ | ğŸ”µ íŒŒë€ìƒ‰ |
| `tool` | ì™¸ë¶€ ë„êµ¬/API/MCP ì§ì ‘ í˜¸ì¶œ (LLM ì—†ì´) | ğŸ”´ ë¹¨ê°„ìƒ‰ |
| `output` | ê²°ê³¼ ì¶œë ¥/ë Œë”ë§ | ğŸŸ¢ ì´ˆë¡ìƒ‰ |

Agent ë…¸ë“œì˜ ë™ì‘ ëª¨ë“œ:
- **tools ë¯¸ì§€ì •**: ë‹¨ë°œ LLM í˜¸ì¶œ (í”„ë¡¬í”„íŠ¸ â†’ ì‘ë‹µ)
- **tools ì§€ì •**: ì—ì´ì „íŠ¸ ë£¨í”„ (LLM í˜¸ì¶œ â†’ ë„êµ¬ í•„ìš”? â†’ ë„êµ¬ ì‹¤í–‰ â†’ ê²°ê³¼ ë¶„ì„ â†’ ë°˜ë³µ)

### 3.4 DAG Runner Execution Flow

```
1. ì›Œí¬í”Œë¡œìš° ë¡œë“œ â†’ DAG êµ¬ì„± (í† í´ë¡œì§€ ì •ë ¬)
2. Session ìƒì„± (ê³ ìœ  ID, ìƒíƒœ ì´ˆê¸°í™”)
3. ë£¨íŠ¸ ë…¸ë“œë¶€í„° ì‹¤í–‰ ì‹œì‘
4. ê° ë…¸ë“œ ì‹¤í–‰:
   a. ì…ë ¥ ìˆ˜ì§‘ (ë¶€ëª¨ ë…¸ë“œ ì¶œë ¥ + ìƒíƒœ ì°¸ì¡°)
   b. ë…¸ë“œ íƒ€ì…ë³„ Executor í˜¸ì¶œ
   c. ì´ë²¤íŠ¸ ë°œí–‰ (node.started, node.completed, node.error)
   d. ì¶œë ¥ì„ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
   e. ë‹¤ìŒ ë…¸ë“œ(ë“¤)ë¡œ ì „íŒŒ
5. fan-out ì‹œ goroutineìœ¼ë¡œ ë³‘ë ¬ ì‹¤í–‰
6. fan-in ì‹œ sync.WaitGroupìœ¼ë¡œ ëª¨ë“  ë¶€ëª¨ ëŒ€ê¸°
7. ëª¨ë“  ë…¸ë“œ ì™„ë£Œ ì‹œ ì›Œí¬í”Œë¡œìš° ì™„ë£Œ ì´ë²¤íŠ¸ ë°œí–‰
```

### 3.5 Event System

```go
type Event struct {
    ID          string
    WorkflowID  string
    SessionID   string
    NodeID      string
    Type        EventType  // node.started, node.completed, node.error,
                           // model.request, model.response,
                           // tool.call, tool.result
    Payload     any
    Timestamp   time.Time
}
```

ëª¨ë“  ì´ë²¤íŠ¸ëŠ” Event Busë¥¼ í†µí•´:
- PostgreSQLì— ì˜êµ¬ ì €ì¥ (ì‹¤í–‰ ê¸°ë¡, ë””ë²„ê¹…)
- WebSocketìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œì— ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°
- ë…¸ë“œ ê°„ ìƒíƒœ ê³µìœ ì˜ ë§¤ê°œì²´

### 3.6 Session & State

```go
type Session struct {
    ID          string
    WorkflowID  string
    State       map[string]any  // ë…¸ë“œ ì¶œë ¥ ì €ì¥ì†Œ
    Events      []Event         // ì´ë²¤íŠ¸ íˆìŠ¤í† ë¦¬
    Status      SessionStatus   // running, completed, failed, paused
    CreatedAt   time.Time
    UpdatedAt   time.Time
}
```

- ê° ë…¸ë“œì˜ ì¶œë ¥ì€ `state[node_id]`ì— ìë™ ì €ì¥
- í…œí”Œë¦¿ `{{node_id.output}}`ë¡œ ë‹¤ë¥¸ ë…¸ë“œì˜ ì¶œë ¥ ì°¸ì¡°
- ì„¸ì…˜ì€ PostgreSQLì— ì˜êµ¬ ì €ì¥ë˜ì–´ ì‹¤í–‰ ì´ë ¥ ì¶”ì  ê°€ëŠ¥

## 4. Model Provider Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Model Provider Layer                  â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          Unified Model Interface (Go)           â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  type ModelProvider interface {                    â”‚ â”‚
â”‚  â”‚      ChatCompletion(req) â†’ stream/response        â”‚ â”‚
â”‚  â”‚      ListModels() â†’ []Model                       â”‚ â”‚
â”‚  â”‚      Supports() â†’ Capabilities                    â”‚ â”‚
â”‚  â”‚  }                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          â”‚           â”‚           â”‚              â”‚ â”‚
â”‚  â–¼          â–¼           â–¼           â–¼              â–¼ â”‚
â”‚ OpenAI   Anthropic   Google     Ollama    llama.cpp  â”‚
â”‚ Compat   Adapter     Adapter    (local)   / vLLM     â”‚
â”‚ Driver                                   (local)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ëª¨ë¸ ì§€ì • ë°©ì‹

```
provider/model-name í˜•ì‹:

model: "openai/gpt-4o"           # OpenAI
model: "anthropic/claude-sonnet-4-20250514"  # Anthropic
model: "google/gemini-2.0-flash" # Google
model: "ollama/llama3.2"         # Ollama (ë¡œì»¬)
model: "llamacpp/my-model.gguf"  # llama.cpp (ë¡œì»¬)
model: "vllm/mistral-7b"         # vLLM (ë¡œì»¬)
model: "openai-compat/http://localhost:8080/v1"  # ì»¤ìŠ¤í…€ ì—”ë“œí¬ì¸íŠ¸
```

### ì „ëµ

- **OpenAI í˜¸í™˜ APIë¥¼ ê¸°ë³¸ ì¸í„°í˜ì´ìŠ¤**ë¡œ ì‚¬ìš©
- Ollama, vLLM, llama.cpp ëª¨ë‘ OpenAI í˜¸í™˜ ì„œë²„ ëª¨ë“œ ì œê³µ â†’ ìë™ ì§€ì›
- Anthropic, Googleì€ ë³„ë„ ì–´ëŒ‘í„°ë¡œ ë„¤ì´í‹°ë¸Œ API ì§€ì›
- ìƒˆ í”„ë¡œë°”ì´ë” ì¶”ê°€ ì‹œ ModelProvider ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ë§Œ í•˜ë©´ ë¨

### ì„¤ì • íŒŒì¼

```yaml
providers:
  openai:
    api_key: "${OPENAI_API_KEY}"
  anthropic:
    api_key: "${ANTHROPIC_API_KEY}"
  google:
    api_key: "${GOOGLE_API_KEY}"
  ollama:
    base_url: "http://localhost:11434"
  llamacpp:
    base_url: "http://localhost:8080"
  vllm:
    base_url: "http://localhost:8000"
```

## 5. Tool System

### Tool Interface

```go
type Tool interface {
    Name() string
    Description() string
    InputSchema() JSONSchema
    Execute(ctx context.Context, input any) (any, error)
}
```

### Tool ì¢…ë¥˜

| ì¢…ë¥˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| Built-in | Upal ë‚´ì¥ ë„êµ¬ | `web_search`, `file_read`, `file_write`, `code_execute` |
| HTTP API | ì™¸ë¶€ REST/GraphQL í˜¸ì¶œ | ì»¤ìŠ¤í…€ API ì—”ë“œí¬ì¸íŠ¸ |
| Function | Go í•¨ìˆ˜ë¡œ ì§ì ‘ êµ¬í˜„ | ì½”ë“œ í¼ìŠ¤íŠ¸ ì‚¬ìš©ììš© ì»¤ìŠ¤í…€ ë¡œì§ |
| MCP | MCP í”„ë¡œí† ì½œë¡œ ì™¸ë¶€ ì„œë²„ ì—°ê²° | `mcp://brave-search`, `mcp://github` |
| Workflow | ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ë„êµ¬ë¡œ í˜¸ì¶œ | ì›Œí¬í”Œë¡œìš° ì¬ì‚¬ìš©/ì»´í¬ì§€ì…˜ |

### MCP ì„œë²„ ì„¤ì •

```yaml
mcp_servers:
  brave-search:
    transport: "stdio"
    command: "npx"
    args: ["-y", "@anthropic/mcp-server-brave-search"]
    env:
      BRAVE_API_KEY: "${BRAVE_API_KEY}"

  github:
    transport: "sse"
    url: "http://localhost:3001/sse"

  custom-db:
    transport: "stdio"
    command: "./my-mcp-server"
```

### Agent ë…¸ë“œì—ì„œ Tool ì‚¬ìš©

```yaml
- id: "researcher"
  type: "agent"
  config:
    model: "openai/gpt-4o"
    system_prompt: "ì›¹ì„ ê²€ìƒ‰í•´ì„œ ë¦¬ì„œì¹˜í•˜ì„¸ìš”."
    tools:
      - "web_search"                    # built-in
      - "mcp://brave-search"            # MCP ì„œë²„
      - "http://api.example.com/data"   # HTTP API
      - "workflow://summarizer"         # ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°
```

## 6. Frontend (Opal-Inspired UI)

### ê¸°ìˆ  ìŠ¤íƒ

| í•­ëª© | ì„ íƒ | ì´ìœ  |
|------|------|------|
| í”„ë ˆì„ì›Œí¬ | React + Vite | ë¹ ë¥¸ ë¹Œë“œ, Go ë°±ì—”ë“œì™€ ë¶„ë¦¬ |
| ì›Œí¬í”Œë¡œìš° ì—ë””í„° | React Flow (xyflow) | ë…¸ë“œ ê¸°ë°˜ ì—ë””í„° í‘œì¤€ |
| ìƒíƒœ ê´€ë¦¬ | Zustand | ê²½ëŸ‰, React Flowì™€ ê¶í•© ì¢‹ìŒ |
| UI ì»´í¬ë„ŒíŠ¸ | Shadcn/ui + Tailwind CSS | ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥ |
| ì‹¤ì‹œê°„ í†µì‹  | WebSocket (native) | ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° |

### 3ê°€ì§€ ë·° ëª¨ë“œ

**1. Editor ë·° (ê¸°ë³¸)** â€” Opal ìŠ¤íƒ€ì¼ ìˆ˜ì§ ì›Œí¬í”Œë¡œìš°
- ìœ„ì—ì„œ ì•„ë˜ë¡œ íë¥´ëŠ” ìŠ¤í…
- ìƒ‰ìƒ ì½”ë”©: ğŸŸ¡ Input, ğŸ”µ Agent, ğŸ”´ Tool, ğŸŸ¢ Output
- ë…¸ë“œ í´ë¦­ â†’ ì¸ë¼ì¸ í¸ì§‘ (í”„ë¡¬í”„íŠ¸, ëª¨ë¸ ì„ íƒ, ë„êµ¬ ì„¤ì •)
- fan-outì€ ìˆ˜í‰ ë¶„ê¸°, fan-inì€ í•©ë¥˜
- `[+ Add Step]` ë²„íŠ¼ + `[ğŸ¤– AIë¡œ ìŠ¤í… ì¶”ê°€]`

**2. Preview ë·°** â€” ìµœì¢… ì‚¬ìš©ì ê²½í—˜
- Input â†’ ì…ë ¥ í¼, Output â†’ ê²°ê³¼ í‘œì‹œë¡œ ë Œë”ë§
- ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°

**3. Code ë·°** â€” Upal ì°¨ë³„ì 
- ì›Œí¬í”Œë¡œìš° JSON/YAML ì§ì ‘ í¸ì§‘
- ì½”ë“œ í¼ìŠ¤íŠ¸ ì‚¬ìš©ììš©
- Editor â†” Code ì–‘ë°©í–¥ ë™ê¸°í™”

### UI ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Upal                                    [Run â–¶] [Settings]  â”‚
â”‚        [Editor] [Preview] [Code]                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ìˆ˜ì§ ì›Œí¬í”Œë¡œìš° ìº”ë²„ìŠ¤ (Opal ìŠ¤íƒ€ì¼)                        â”‚
â”‚                                                              â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚           â”‚ ğŸŸ¡ User Input           â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                        â”‚                                     â”‚
â”‚                        â–¼                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚           â”‚ ğŸ”µ Agent: Researcher    â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                        â”‚                                     â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                â”‚
â”‚                   â–¼         â–¼                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚ğŸ”µ Writer â”‚ â”‚ğŸ”µ Writer â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                     â–¼                                        â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚           â”‚ ğŸŸ¢ Output               â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                              â”‚
â”‚  [+ Add Step]  [ğŸ¤– AIë¡œ ìŠ¤í… ì¶”ê°€]                           â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ Console   [Step 1 âœ…] [Step 2 ğŸ”„] [Step 3 â³]           â”‚
â”‚  > Agent "Researcher" â†’ web_search("query")                  â”‚
â”‚  > Received 3 results, analyzing...                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë…¸ë“œ ì¸ë¼ì¸ í¸ì§‘

ë³„ë„ Properties Panel ëŒ€ì‹  ë…¸ë“œ í´ë¦­ ì‹œ ë…¸ë“œ ë‚´ë¶€ì—ì„œ ë°”ë¡œ í¸ì§‘:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”µ Agent: Researcher         [â‹®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Model: [ollama/llama3.2     â–¾]   â”‚
â”‚                                  â”‚
â”‚ System Prompt:                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ë‹¹ì‹ ì€ ë¦¬ì„œì¹˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.  â”‚ â”‚
â”‚ â”‚ {{input.text}} ì£¼ì œì— ëŒ€í•´   â”‚ â”‚
â”‚ â”‚ ê¹Šì´ìˆê²Œ ì¡°ì‚¬í•´ì£¼ì„¸ìš”.       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ Tools: â˜‘ web_search             â”‚
â”‚        â˜‘ mcp://brave-search     â”‚
â”‚        â˜ file_read              â”‚
â”‚                                  â”‚
â”‚ Advanced â–¾                       â”‚
â”‚   Max turns: [5]                 â”‚
â”‚   Temperature: [0.7]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. Project Structure

```
upal/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ upal/
â”‚       â””â”€â”€ main.go               # ì„œë²„ + CLI í†µí•© ë°”ì´ë„ˆë¦¬
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ engine/                   # ì›Œí¬í”Œë¡œìš° ì—”ì§„ (Core)
â”‚   â”‚   â”œâ”€â”€ runner.go             # DAG Runner
â”‚   â”‚   â”œâ”€â”€ node.go               # Node ì¸í„°í˜ì´ìŠ¤ + Registry
â”‚   â”‚   â”œâ”€â”€ edge.go               # Edge ì •ì˜ + ë£¨í”„ ê°ì§€
â”‚   â”‚   â”œâ”€â”€ session.go            # Session & State ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ event.go              # Event Bus
â”‚   â”‚
â”‚   â”œâ”€â”€ nodes/                    # ë…¸ë“œ íƒ€ì… êµ¬í˜„
â”‚   â”‚   â”œâ”€â”€ input.go
â”‚   â”‚   â”œâ”€â”€ agent.go
â”‚   â”‚   â”œâ”€â”€ tool.go
â”‚   â”‚   â””â”€â”€ output.go
â”‚   â”‚
â”‚   â”œâ”€â”€ provider/                 # Model Provider Layer
â”‚   â”‚   â”œâ”€â”€ provider.go           # Provider ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ openai.go             # OpenAI í˜¸í™˜ ë“œë¼ì´ë²„
â”‚   â”‚   â”œâ”€â”€ anthropic.go          # Anthropic ì–´ëŒ‘í„°
â”‚   â”‚   â”œâ”€â”€ google.go             # Google Gemini ì–´ëŒ‘í„°
â”‚   â”‚   â”œâ”€â”€ ollama.go             # Ollama
â”‚   â”‚   â”œâ”€â”€ llamacpp.go           # llama.cpp
â”‚   â”‚   â””â”€â”€ vllm.go               # vLLM
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/                    # Tool ì‹œìŠ¤í…œ
â”‚   â”‚   â”œâ”€â”€ registry.go
â”‚   â”‚   â”œâ”€â”€ builtin.go
â”‚   â”‚   â”œâ”€â”€ http.go
â”‚   â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â”‚   â”œâ”€â”€ stdio.go
â”‚   â”‚   â”‚   â””â”€â”€ sse.go
â”‚   â”‚   â””â”€â”€ workflow.go
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # HTTP/WebSocket API
â”‚   â”‚   â”œâ”€â”€ server.go
â”‚   â”‚   â”œâ”€â”€ workflow.go
â”‚   â”‚   â”œâ”€â”€ execution.go
â”‚   â”‚   â””â”€â”€ ws.go
â”‚   â”‚
â”‚   â””â”€â”€ store/                    # ë°ì´í„° ì €ì¥ì†Œ
â”‚       â”œâ”€â”€ store.go
â”‚       â”œâ”€â”€ postgres.go
â”‚       â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ web/                          # React í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.tsx
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ editor/
â”‚       â”‚   â”‚   â”œâ”€â”€ Canvas.tsx
â”‚       â”‚   â”‚   â””â”€â”€ nodes/
â”‚       â”‚   â”‚       â”œâ”€â”€ InputNode.tsx
â”‚       â”‚   â”‚       â”œâ”€â”€ AgentNode.tsx
â”‚       â”‚   â”‚       â”œâ”€â”€ ToolNode.tsx
â”‚       â”‚   â”‚       â””â”€â”€ OutputNode.tsx
â”‚       â”‚   â”œâ”€â”€ preview/
â”‚       â”‚   â”œâ”€â”€ code/
â”‚       â”‚   â””â”€â”€ console/
â”‚       â”œâ”€â”€ stores/
â”‚       â””â”€â”€ lib/
â”‚
â”œâ”€â”€ config.yaml
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ go.mod
â””â”€â”€ README.md
```

## 8. Tech Stack Summary

### Backend (Go)

| ìš©ë„ | ë¼ì´ë¸ŒëŸ¬ë¦¬ |
|------|-----------|
| HTTP Router | go-chi/chi |
| WebSocket | coder/websocket |
| PostgreSQL | jackc/pgx |
| DB ë§ˆì´ê·¸ë ˆì´ì…˜ | pressly/goose |
| ì„¤ì • ê´€ë¦¬ | koanf |
| ë¡œê¹… | slog (í‘œì¤€) |
| JSON Schema | santhosh-tekuri/jsonschema |

### Frontend (React)

| ìš©ë„ | ë¼ì´ë¸ŒëŸ¬ë¦¬ |
|------|-----------|
| í”„ë ˆì„ì›Œí¬ | React + Vite |
| ì›Œí¬í”Œë¡œìš° ì—ë””í„° | React Flow (xyflow) |
| ìƒíƒœ ê´€ë¦¬ | Zustand |
| UI ì»´í¬ë„ŒíŠ¸ | Shadcn/ui + Tailwind CSS |

### Infrastructure

| ìš©ë„ | ì„ íƒ |
|------|------|
| ë°ì´í„°ë² ì´ìŠ¤ | PostgreSQL 17 |
| ë°°í¬ | Docker Compose |
| ë¹Œë“œ | Go embed (React â†’ ë‹¨ì¼ ë°”ì´ë„ˆë¦¬) |

## 9. Opal Feature Mapping

| Opal ê¸°ëŠ¥ | Upal ëŒ€ì‘ | MVP |
|-----------|-----------|-----|
| ìì—°ì–´ë¡œ ì•± ìƒì„± | LLMì´ ì›Œí¬í”Œë¡œìš° JSON ìƒì„± | í›„ìˆœìœ„ |
| ë¹„ì£¼ì–¼ ì›Œí¬í”Œë¡œìš° ì—ë””í„° | React Flow ê¸°ë°˜ ì—ë””í„° | âœ… |
| User Input ë…¸ë“œ | input ë…¸ë“œ | âœ… |
| Generate ë…¸ë“œ | agent ë…¸ë“œ (tools ì—†ì´) | âœ… |
| Output ë…¸ë“œ | output ë…¸ë“œ | âœ… |
| Assets | íŒŒì¼ ì—…ë¡œë“œ + ì»¨í…ìŠ¤íŠ¸ ì£¼ì… | âœ… |
| í”„ë¡¬í”„íŠ¸ ì²´ì´ë‹ | `{{node_id.output}}` í…œí”Œë¦¿ | âœ… |
| ë‹¤ì¤‘ ëª¨ë¸ | ë¡œì»¬+í´ë¼ìš°ë“œ ììœ  í˜¼í•© | âœ… |
| ì‹¤ì‹œê°„ ì½˜ì†” | WebSocket ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ | âœ… |
| ìì—°ì–´ í¸ì§‘ | LLMì´ ì›Œí¬í”Œë¡œìš° JSON ìˆ˜ì • | í›„ìˆœìœ„ |
| í…Œë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§• | ê³ ì • í…Œë§ˆ (í›„ì— í™•ì¥) | í›„ìˆœìœ„ |
| ë²„ì „ íˆìŠ¤í† ë¦¬ | PostgreSQL ë²„ì „ ì €ì¥ | âœ… |
| ê³µìœ /í¼ë¸”ë¦¬ì‹± | ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° | í›„ìˆœìœ„ |
| ë‚´ì¥ ë„êµ¬ | MCP í˜¸í™˜ + ë‚´ì¥ ë„êµ¬ | âœ… |

## 10. Sources

- [Google Opal](https://opal.google/)
- [Google Opal Developer Docs](https://developers.google.com/opal/overview)
- [Google ADK Documentation](https://google.github.io/adk-docs/)
- [ADK Technical Overview](https://google.github.io/adk-docs/get-started/about/)
- [ADK Multi-Agent Systems](https://google.github.io/adk-docs/agents/multi-agents/)
- [ADK GitHub (Python)](https://github.com/google/adk-python)
- [Google Developers Blog - Opal](https://developers.googleblog.com/introducing-opal/)
- [Google Developers Blog - ADK](https://developers.googleblog.com/en/agent-development-kit-easy-to-build-multi-agent-applications/)
